[2026-02-06] Restructured PRD.json for agent-optimized task tracking
- Transformed 7 phases into 100 granular features with verification steps (F000-F099)
- Added environmentSetup, progressTracking, features[] sections
- Preserved original PRD structure in originalPRD section
- Created init.sh script for local environment automation
- Updated ralph-once.sh to reference PRD.json instead of PRD.md
- Status: Ready for agent-driven implementation

Features breakdown:
- Phase 0 (Project Definition): F000-F007 (8 features)
- Phase 1 (Architecture): F008-F020 (13 features)
- Phase 2 (Shopify Integration): F021-F038 (18 features)
- Phase 3 (Data Model & API): F039-F056 (18 features)
- Phase 4 (Compliance UI): F057-F069 (13 features)
- Phase 5 (Exports & Public Pages): F070-F081 (12 features)
- Phase 6 (Production Hardening): F082-F099 (18 features)

Next task: F000 - Repository Initialization

Run ./ralph-once.sh to start implementing features one at a time.

[2026-02-10] F000 - Repository Initialization (PASSES)
- Initialized git repository with `git init`
- Created .gitignore with entries for: node_modules, build outputs, env files, IDE files, OS files, logs, coverage, Turbo cache, Prisma local DBs, Docker overrides, and temp files
- Updated F000 status to "passes" in PRD.json
- Next task: F001 - Environment Variable Template

[2026-02-10] F001 - Environment Variable Template (PASSES)
- Created .env.example with all required variables from PRD environmentSetup
- Sections: App (NODE_ENV, APP_URL, PORT, LOG_LEVEL), Shopify (API_KEY, API_SECRET, SCOPES), Database (DATABASE_URL), Redis (REDIS_URL), Session (SESSION_SECRET), Object Storage (S3_BUCKET, S3_ACCESS_KEY, S3_SECRET_KEY, S3_REGION, S3_ENDPOINT)
- Added inline comments documenting each section
- Updated F001 status to "passes" in PRD.json
- Next task: F002 - Docker Compose Configuration

[2026-02-10] F002 - Docker Compose Configuration (PASSES)
- Created docker-compose.yml with Postgres 15 (Alpine) and Redis 7 (Alpine)
- Postgres configured with user/password/db matching .env.example DATABASE_URL
- Both services have health checks (pg_isready, redis-cli ping)
- Named volumes (pgdata, redisdata) for data persistence across restarts
- Validated config with `docker compose config`
- Updated F002 status to "passes" in PRD.json
- Next task: F003 - Entity Relationship Diagram

[2026-02-10] F003 - Entity Relationship Diagram (PASSES)
- Created docs/schema/erd.md with full Mermaid ERD
- 6 tables designed: tenants, products, compliance_records, audit_logs, users, exports
- All 10 compliance attributes mapped to compliance_records columns (JSONB for structured/list types)
- Documented relationships, table descriptions, key indexes, and constraints
- Covers multi-tenancy (tenant_id on all tables), RBAC (user roles), audit trail (append-only), soft delete, export tracking
- Updated F003 status to "passes" in PRD.json
- Next task: F004 - Risk Register Documentation

[2026-02-10] F004 - Risk Register Documentation (PASSES)
- Created docs/risks.md with all 10 risks (R001-R010) from PRD riskRegister
- Includes summary risk matrix table with ID, category, likelihood, impact, rating, and owner
- Each risk has detailed description and full mitigation list
- Categories: Regulatory, Data Integrity, Technical, Security/Privacy, Business, Operations, Compliance
- 4 High-rated risks (R001, R003, R008, R009), 5 Medium, 1 Low
- Updated F004 status to "passes" in PRD.json
- Next task: F005 - User Persona Validation

[2026-02-10] ERD Review
- Fixed redundant `status` column on products table (duplicated `shopify_status` with same enum values)
- Products now have: `shopify_status` (mirrors Shopify), `compliance_status` (internal tracking), `is_deleted` (soft delete)

[2026-02-10] F005 - User Persona Validation (PASSES)
- Created docs/personas.md with both personas from PRD
- Primary: EU-Facing Shopify Merchant (5-200 SKUs, low-medium tech skill)
- Secondary: Compliance Officer / Operations Manager (50-200 SKUs, high regulatory knowledge)
- Added success metrics measurement approach, design implications per persona
- Included validation checklist with items to confirm with target merchants during beta
- Updated F005 status to "passes" in PRD.json
- Next task: F006 - Scope Boundary Document

[2026-02-10] F006 - Scope Boundary Document (PASSES)
- Created docs/scope.md with in-scope features (11 items), exclusions (13 items), and boundary notes
- Added rationale column to exclusions table
- Included future considerations section (DPP, EPR, carbon footprint, etc.)
- Added stakeholder sign-off tracking table
- Updated F006 status to "passes" in PRD.json
- Next task: F007 - Non-Functional Requirements Checklist

[2026-02-10] F007 - Non-Functional Requirements Checklist (PASSES)
- Created docs/nfr-checklist.md with all 10 enterprise requirement categories as checkboxes
- Categories: Security (11), Audit Trail (5), Observability (7), Backups/DR (6), Test Coverage (6), SLOs (5), Documentation (8), Multi-Tenancy (5), Data Integrity (5), Compliance/Privacy (5)
- Added performance and scalability targets summary table
- Updated F007 status to "passes" in PRD.json
- Phase 0 (Project Definition) is now COMPLETE (F000-F007 all pass)
- Next task: F008 - Monorepo Setup (Phase 1 begins)

[2026-02-12] F008 - Monorepo Setup (PASSES)
- Chose Turborepo as monorepo tool (lighter weight, better fit for Shopify Remix ecosystem)
- Created root package.json with npm workspaces (apps/*, packages/*)
- Created turbo.json with task pipeline: build, dev, lint, test, typecheck, clean
- Build tasks use dependency ordering (dependsOn: ["^build"]), dev is persistent/uncached
- Scaffolded 5 workspaces per PRD repository structure:
  - apps/shopify-admin (Remix embedded app)
  - apps/api (REST API)
  - apps/worker (background jobs)
  - packages/db (database schema/migrations)
  - packages/shared (shared types/utils/validation)
- Installed Turborepo (v2.8.7), verified all 5 packages recognized by npm workspaces
- Verified Turbo build pipeline: all 5 packages build successfully
- Verified Turbo caching: second run hits cache on all 5 tasks (FULL TURBO)
- Updated F008 status to "passes" in PRD.json
- Next task: F009 - Database ORM Setup

[2026-02-12] F009 - Database ORM Setup (PASSES)
- Chose Prisma as ORM (referenced in PRD filesAffected, strong migration tooling, type-safe client)
- Installed prisma (dev) and @prisma/client in packages/db
- Created full Prisma schema (packages/db/prisma/schema.prisma) with all 6 models from ERD:
  - Tenant (tenants): shop isolation, encrypted access tokens, plan/status enums
  - Product (products): Shopify sync mirror, compliance status tracking, soft delete
  - ComplianceRecord (compliance_records): all 10 compliance attributes, 1:1 with products, version counter
  - AuditLog (audit_logs): append-only, before/after JSONB snapshots, action/entity enums
  - User (users): RBAC (admin/editor/viewer), Shopify user association
  - Export (exports): lifecycle tracking (queued/processing/completed/failed), S3 file storage
- All models use UUID primary keys, snake_case table/column mapping, timestamptz timestamps
- 9 enums: Plan, TenantStatus, ShopifyStatus, ComplianceStatus, AuditAction, EntityType, UserRole, ExportFormat, ExportStatus
- Indexes and unique constraints match ERD specification
- Created src/index.ts with PrismaClient singleton (dev hot-reload safe)
- Configured prisma.config.ts for migrations and datasource
- Updated turbo.json to include generated/** in build outputs
- Schema validates (prisma validate) and client generates successfully (prisma generate)
- 54 tests passing: schema validation, model definitions, table mappings, UUID PKs, tenant isolation, unique constraints, indexes, compliance attributes, enum values
- Updated F009 status to "passes" in PRD.json
- Next task: F010 - Architecture Diagrams

[2026-02-12] F010 - Architecture Diagrams (PASSES)
- Created docs/architecture/system-overview.md with comprehensive Mermaid diagrams
- System overview diagram: Shopify platform, 3 app workspaces, 2 shared packages, infrastructure (Postgres, Redis, S3), external consumers
- Component descriptions table: 8 components with workspace paths and purposes
- Multi-tenancy model: row-level tenant isolation via tenant_id on all tables
- RBAC model table: Admin/Editor/Viewer permissions across Products, Compliance, Exports, Audit, Settings
- 5 data flow sequence diagrams per PRD:
  1. OAuth Installation and Authentication
  2. Product Sync (Webhook-Triggered) with HMAC verification and job queuing
  3. Product Sync (Scheduled Reconciliation) with cursor-based pagination
  4. Compliance Data Editing with Audit Trail (transactional with version increment)
  5. Export Generation and Delivery (async via BullMQ, S3 upload, signed URLs)
- Environments table: Development (Docker Compose), Staging (cloud), Production (cloud)
- Cross-cutting concerns: Logging, Metrics, Tracing, Rate Limiting, Input Validation, Error Handling
- Technology decisions table with rationale: Turborepo, Prisma, PostgreSQL, BullMQ, Remix, Polaris, Zod
- 39 tests passing: file existence, diagram content, component coverage, data flows, multi-tenancy, RBAC, cross-cutting concerns, technology decisions, environments
- Updated F010 status to "passes" in PRD.json
- Next task: F011 - OpenAPI Spec Skeleton
